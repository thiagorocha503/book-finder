"use strict";const API_VERSION="1",BASE_API_URL="https://www.googleapis.com",ENTER_KEY="Enter";let total=0,limit=20,offset=0,currentQuery="",scrollBlock=!1;$((()=>{function e(e,l=0){if(0!=l&&l+limit>total)return;let n=`${BASE_API_URL}/books/v1/volumes?`+new URLSearchParams({q:e,startIndex:`${l}`,maxResults:`${limit}`});console.info("[URL] ",n),0==l?($("#loading").css("display","block"),$("#card-list").html("")):($("#loading").css("display","none"),$("#card-list").append(function(){let e=document.createElement("div");e.id="loading-bottom",e.style.padding="8px",e.classList.add("text-center");let t=document.createElement("img");return t.src="img/loading.gif",e.append(t),e}())),fetch(n,{headers:new Headers,method:"GET"}).then((e=>e.json())).then((n=>{let o=0!=n.totalItems?n.items:[];total=n.totalItems;let s=$("#card-list");if($("#loading").css("display","none"),$("#loading-bottom").remove(),0==o.length){let e=document.createElement("div");e.id="card-list",e.className="col mb-4 text-muted",e.innerHTML="No results found",s.replaceWith(e)}else if(0==l)s.replaceWith(function(e){let l=document.createElement("div");return l.className="col mb-4",l.id="card-list",e.forEach((e=>{let n=t(e);l.appendChild(n)})),l}(o));else{let e=$("#card-list");for(let l=0;l<o.length;l++){let n=t(o[l]);e.append(n)}}currentQuery=e,scrollBlock=!1})).catch((e=>{console.log("Erro: ",e)}))}function t(e){let t=document.createElement("div");return t.className="card shadow-sm mb-2",t.insertAdjacentHTML("afterbegin",`\n        <div class="card-header d-block d-sm-none"><h5 class="text-gray">${e.volumeInfo.title}</h5></div><div class="card-body d-flex"><div style="min-width: 128px;"><img  class="fluid-img" alt="image not available" src=${null!=e.volumeInfo.imageLinks?e.volumeInfo.imageLinks.smallThumbnail:"img/thumbnail.png"}></div><div class="px-3 flex-grow-1"><h4 class="text-gray d-none d-sm-block">${e.volumeInfo.title}</h4><div class="d-flex flex-column" ><p class="order-sm-2">${null!=e.searchInfo?e.searchInfo.textSnippet:""}</p><p class="order-sm-1 text-gray text-muted">${null!=e.volumeInfo.authors?e.volumeInfo.authors.map(((e,t)=>e.trim())).join(""):"author unknown"} ${null!=e.volumeInfo.publishedDate?" | "+function(e){if(null==e)return"";if(new RegExp("^\\d{4}-\\d{2}-\\d{2}$").test(e))return e.slice(0,4);return e}(e.volumeInfo.publishedDate):""}</p></div><a href=${null!=e.volumeInfo.infoLink?e.volumeInfo.infoLink:""} class="btn btn-primary btn-sm text-white" target="_blank" >See more</a></div></div>`),t}$("#btn-search").on("click",(()=>{e($("#txt-search").val())})),$(window).on("scroll",(()=>{window.innerHeight+window.pageYOffset>=document.body.offsetHeight-50&&(scrollBlock||(offset+=limit,scrollBlock=!0,e(currentQuery,offset)))})),$("#txt-search").on("keypress",(t=>{if("Enter"==t.code){$("#txt-search").removeClass("is-invalid");let t=$("#search-feedback");if(t.removeClass("d-block"),""==$("#txt-search").val())return console.warn("Empty query"),$("#txt-search").addClass("is-invalid"),void t.addClass("d-block");e($("#txt-search").val())}}))}));